window.__require=function t(e,n,o){function c(a,i){if(!n[a]){if(!e[a]){var s=a.split("/");if(s=s[s.length-1],!e[s]){var u="function"==typeof __require&&__require;if(!i&&u)return u(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+a+"'")}}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){return c(e[a][1][t]||t)},l,l.exports,t,e,n,o)}return n[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<o.length;a++)c(o[a]);return c}({EndDialog:[function(t,e,n){"use strict";cc._RF.push(e,"5ae9aNOMTlPWbyviqBepbS3","EndDialog"),function(){var e;e=t("./Utils"),cc.Class({extends:cc.Component,properties:{m_score_label:cc.Label},onLoad:function(){return 0,0,e.triggerEvent("getMoney",function(t){return function(n){var o,c,r;return c=n.money,r=n.stockMoney,o=c+r,(e.getItem("highScore")||0)<o&&(e.setItem("highScore",o),"undefined"!=typeof TDGA&&null!==TDGA&&TDGA.onEvent("\u6700\u9ad8\u5206",{score:e.formatNum(o)})),t.m_score_label.string="\u4f60\u7684\u603b\u8d44\u4ea7\u662f: "+e.formatNum(o)}}(this)),e.setItem("gameFinish",!0)},onBack:function(){return cc.director.loadScene("WelcomeDialog")},update:function(t){}})}.call(this),cc._RF.pop()},{"./Utils":"Utils"}],ExchangePanel:[function(t,e,n){"use strict";cc._RF.push(e,"a96cdoj+wpExoHoM5QUL1Yb","ExchangePanel"),function(){var e;t("./stockInfo"),e=t("./Utils"),cc.Class({extends:cc.Component,properties:{m_input_label:cc.EditBox,m_buy_button:cc.Node,m_sale_button:cc.Node,m_max_num:cc.Label},onLoad:function(){var t,n,o;return n=(t=e.getDataFromNode()).stockCode,o=t.type,console.log("stockCode:"+n),"undefined"!=typeof TDGA&&null!==TDGA&&TDGA.onEvent("exchange",{type:o}),this._stockCode=n,this._exchangeType=o,this._exchangeNum=100,this._setExchangeButton(),this._initBuyNodeInfo(n),this._addBuyPanelEditbox()},_setExchangeButton:function(){return this.m_buy_button.active="buy"===this._exchangeType,this.m_sale_button.active="sale"===this._exchangeType},_initBuyNodeInfo:function(t){var n,o,c,r;return n=0,e.triggerEvent("getMoney",function(t){var e;return e=t.money,n=e}),c=0,e.triggerEvent("getOwnStockNum",{stockCode:t,callback:function(t){return c=t}}),o=cc.find("buyNode/name",this.node).getComponent(cc.Label),e.triggerEvent("getStockName",{stockCode:t,callback:function(t){return o.string=t}}),r=cc.find("buyNode/price",this.node).getComponent(cc.Label),e.triggerEvent("getStockPrice",{stockCode:t,callback:function(t){return function(e){var o;return r.string=e,"buy"===t._exchangeType?(o=Math.floor(n/e),t.m_max_num.string=o):"sale"===t._exchangeType?(o=c,t.m_max_num.string=o):void 0}}(this)})},_addBuyPanelEditbox:function(){return this._addEditBoxEventHandler(this.m_input_label)},_addEditBoxEventHandler:function(t){var e;return(e=new cc.Component.EventHandler).target=this.node,e.component="ExchangePanel",e.handler="onTextChanged",t.editingDidEnded.push(e)},onTextChanged:function(t){return this._exchangeNum=parseInt(t.string)},onBuy:function(){var t,n;return t=this._exchangeNum,n=this._stockCode,e.triggerEvent("buyStock",{stockCode:n,num:t}),cc.director.loadScene("game")},onSale:function(){var t,n;return t=this._exchangeNum,n=this._stockCode,e.triggerEvent("saleStock",{stockCode:n,num:t}),cc.director.loadScene("OwnStocksDialog")},onClose:function(){return"buy"===this._exchangeType?cc.director.loadScene("game"):cc.director.loadScene("OwnStocksDialog")}})}.call(this),cc._RF.pop()},{"./Utils":"Utils","./stockInfo":"stockInfo"}],HelpDialog:[function(t,e,n){"use strict";cc._RF.push(e,"ba79d+G+A9ArLBw/FlYkRxz","HelpDialog"),function(){cc.Class({extends:cc.Component,properties:{m_help_content:cc.Label},onLoad:function(){return"undefined"!=typeof TDGA&&null!==TDGA&&TDGA.onEvent("openHelp"),this.m_help_content.string="\u662f\u5426\u53d1\u73b0\u4e86\u5176\u4e2d\u7684\u5965\u79d8\u5462\uff1f"},onBack:function(){return cc.director.loadScene("WelcomeDialog")},update:function(t){}})}.call(this),cc._RF.pop()},{}],OwnStocksDialog:[function(t,e,n){"use strict";cc._RF.push(e,"99f90cUlH1KSqWdr830GD97","OwnStocksDialog"),function(){var e;e=t("./Utils"),cc.Class({extends:cc.Component,properties:{m_own_stock_prefab:cc.Prefab,m_own_stocks_content:cc.Node},onLoad:function(){return"undefined"!=typeof TDGA&&null!==TDGA&&TDGA.onEvent("ownStock"),this._showAllStocks()},_initOwnStockInfo:function(t,e){return cc.find("name",t).getComponent(cc.Label).string=e.stockName,cc.find("num",t).getComponent(cc.Label).string=e.num,cc.find("price",t).getComponent(cc.Label).string=e.price},_showAllStocks:function(){var t,n,o,c,r,a;for(c=[],e.triggerEvent("getOwnStocks",function(t){return c=t}),a=cc.instantiate(this.m_own_stock_prefab),this.m_own_stocks_content.addChild(a),this._initOwnStockInfo(a,{stockName:"\u540d\u79f0",num:"\u6570\u91cf",price:"\u6210\u672c\u4ef7\u683c"}),n=0,o=c.length;n<o;n++)r=c[n],a=cc.instantiate(this.m_own_stock_prefab),this.m_own_stocks_content.addChild(a),this._initOwnStockInfo(a,r),t=cc.find("touch",a).getComponent(cc.Button),this._addTouchEvent(t,r.stockCode)},_addTouchEvent:function(t,e){var n;return(n=new cc.Component.EventHandler).target=this.node,n.component="OwnStocksDialog",n.handler="onTouchItem",n.customEventData=e,t.getComponent(cc.Button).clickEvents.push(n)},onTouchItem:function(t,n){var o;return console.log("customEventData:"+JSON.stringify(n)),o=n,this._onExchangeStockCode=o,e.setDataOnNode({stockCode:o,type:"sale"}),e.triggerEvent("showExchangeDialog")},onClose:function(){return cc.director.loadScene("game")}})}.call(this),cc._RF.pop()},{"./Utils":"Utils"}],Record:[function(t,e,n){"use strict";cc._RF.push(e,"c0571UcoHlED7JpJIq7em3J","Record"),function(){cc.Class({extends:cc.Component,properties:{},onLoad:function(){return cc.game.addPersistRootNode(this.node)},setData:function(t){return this._data=t},getData:function(){return this._data}})}.call(this),cc._RF.pop()},{}],StockData:[function(t,e,n){"use strict";cc._RF.push(e,"cd330Cu+h9CIoQjhoD900Zs","StockData"),function(){var t;t=function(){function t(t){this._info=t,this.reset()}return t.prototype.reset=function(){return this._data={name:this._info.name,price:this._info.price,PE:this._info.PE}},t.prototype.getName=function(){return this._data.name},t.prototype.getPrice=function(){return this._data.price},t.prototype.setPrice=function(t){return this._data.price=t},t.prototype.getPriceWave=function(){return this._info.priceWave},t.prototype.getPE=function(){return this._data.PE},t.prototype.setPE=function(t){return this._data.PE=t},t.prototype.getPEWave=function(){return this._info.PEWave},t.prototype.getOriginPE=function(){return this._info.PE},t.prototype.save=function(){return this._data},t.prototype.load=function(t){return this._data=t},t}(),e.exports=t}.call(this),cc._RF.pop()},{}],UserData:[function(t,e,n){"use strict";cc._RF.push(e,"4cbf7DYlylLo4kYOAa+G12x","UserData"),function(){var t;t=function(){function t(){this.reset()}return t.prototype.getYear=function(){return this._data.year},t.prototype.addYear=function(){return this._data.year+=1},t.prototype.getMoney=function(){return this._data.money},t.prototype.setMoney=function(t){return this._data.money=t},t.prototype.getOwnStocks=function(){return this._data.ownStocks},t.prototype.setOwnStocks=function(t){return this._data.ownStocks=t},t.prototype.reset=function(){return this._data={name:"",year:0,money:1e6,ownStocks:[]}},t.prototype.save=function(){return this._data},t.prototype.load=function(t){return this._data=t},t}(),e.exports=t}.call(this),cc._RF.pop()},{}],Utils:[function(t,e,n){"use strict";cc._RF.push(e,"81c4722ILxLYJM0YaBlt0t/","Utils"),function(){var t;t={triggerEvent:function(t,e){return cc.director.getScene().getChildByName("LogicNode").emit(t,e)},getDataFromNode:function(){return cc.director.getScene().getChildByName("RecordNode").getComponent("Record").getData()},setDataOnNode:function(t){return cc.director.getScene().getChildByName("RecordNode").getComponent("Record").setData(t)},formatNum:function(t){return(t+"").replace(/\d{1,3}(?=(\d{3})+$)/g,"$&,")},setItem:function(t,e){return cc.sys.localStorage.setItem(t,JSON.stringify(e))},getItem:function(t){try{return JSON.parse(cc.sys.localStorage.getItem(t))}catch(t){}}},e.exports=t}.call(this),cc._RF.pop()},{}],WelcomeDialog:[function(t,e,n){"use strict";cc._RF.push(e,"44e0eRsENZBtKAXPR8xyDfM","WelcomeDialog"),function(){var e;e=t("./Utils"),cc.Class({extends:cc.Component,properties:{m_high_score:cc.Label},onLoad:function(){var t;return this._isFinish=e.getItem("gameFinish")||!1,t=e.getItem("highScore")||0,this.m_high_score.string="\u6700\u597d\u6210\u7ee9: "+e.formatNum(t),console.log("isFinish:"+this._isFinish)},onBegin:function(){return"undefined"!=typeof TDGA&&null!==TDGA&&TDGA.onEvent("begin"),!0===this._isFinish&&(e.triggerEvent("resetGame"),e.setItem("gameFinish",!1)),cc.director.loadScene("game")},onHelp:function(){return cc.director.loadScene("HelpDialog")},update:function(t){}})}.call(this),cc._RF.pop()},{"./Utils":"Utils"}],game:[function(t,e,n){"use strict";cc._RF.push(e,"ec5035Y1StP5K4HK7nqjpm/","game"),function(){var e,n;e=t("./stockInfo"),n=t("./Utils"),cc.Class({extends:cc.Component,properties:{m_content:cc.Node,m_stock_prefab:cc.Prefab,m_year:cc.Label,m_money:cc.Label,m_stock_money:cc.Label,m_last_year:cc.Label},onLoad:function(){return this._stockPanelTable=[],this._updateYear(),this._updateMoney(),this._initStockPanel(),this._updateStockInfo()},_updateMoney:function(){var t,e;return e=0,t=0,n.triggerEvent("getMoney",function(n){var o,c;return o=n.money,c=n.stockMoney,e=o,t=c}),this.m_money.string="\u6e38\u620f\u5e01: "+n.formatNum(e),this.m_stock_money.string="\u5e02\u503c: "+n.formatNum(t)},_initStockPanel:function(){var t,n,o;for(n in e)e[n],o=cc.instantiate(this.m_stock_prefab),this.m_content.addChild(o),this._stockPanelTable.push(o),t=cc.find("touch",o),this._addTouchEvent(t,n)},_initName:function(t,e){var o;return o=cc.find("infoNode/name",this._stockPanelTable[e]).getComponent(cc.Label),n.triggerEvent("getStockName",{stockCode:t,callback:function(t){return o.string=t}})},_initPrice:function(t,e){var o;return o=cc.find("infoNode/price",this._stockPanelTable[e]).getComponent(cc.Label),n.triggerEvent("getStockPrice",{stockCode:t,callback:function(t){return o.string="\u5e02\u4ef7: "+t}})},_initPE:function(t,e){var o;return o=cc.find("infoNode/pe",this._stockPanelTable[e]).getComponent(cc.Label),n.triggerEvent("getStockPE",{stockCode:t,callback:function(t){return o.string="PE: "+t}})},_updateStockInfo:function(){var t,o;for(t in-1,n.triggerEvent("getYear",function(t){return t}),o=0,e)e[t],this._initName(t,o),this._initPrice(t,o),this._initPE(t,o),o++},_addTouchEvent:function(t,e){var n;return(n=new cc.Component.EventHandler).target=this.node,n.component="game",n.handler="onTouchItem",n.customEventData=e,t.getComponent(cc.Button).clickEvents.push(n)},onTouchItem:function(t,e){var o;return console.log("customEventData:"+JSON.stringify(e)),o=e,this._onExchangeStockCode=o,n.setDataOnNode({stockCode:o,type:"buy"}),n.triggerEvent("showExchangeDialog")},_updateYear:function(){var t;return t=-1,n.triggerEvent("getYear",function(e){return t=e}),this.m_year.string="\u5e74\u4efd: "+(t+2019),this.m_last_year.string="\u8fd8\u5269 "+(50-t)+" \u5e74\u9000\u4f11"},onNextYear:function(){var t;if("undefined"!=typeof TDGA&&null!==TDGA&&TDGA.onEvent("nextYear"),t=!1,n.triggerEvent("nextYear",function(e){return t=e}),t)return this._updateYear(),this._updateMoney(),this._updateStockInfo()},onOpenOwnStock:function(){return n.triggerEvent("openMyStockDialog")}})}.call(this),cc._RF.pop()},{"./Utils":"Utils","./stockInfo":"stockInfo"}],logic:[function(t,e,n){"use strict";cc._RF.push(e,"31d45sv0B9OqpK/+m//J70n","logic"),function(){var e,n,o,c,r;n=t("./StockData"),o=t("./stockInfo"),c=t("./UserData"),r=t("./Utils"),e=[1,6,6,7,7,6,6,10,20,50,60,100,150,-20,-10,-30,6,6,6,7,8,-5,5,-5,6,-20,-10,10,10,30,50,60,90,200,300,10,20,-10,-20,30,-20,5,6,7,9,10,-20,-10,90,-40,80],cc.Class({extends:cc.Component,onLoad:function(){return this._userData=new c,this._loadUserData(),this._registerEventListener(),this._initStockInfo(),this._loadStockData(),cc.game.addPersistRootNode(this.node)},_loadUserData:function(){var t,e;return t=this._userData.save(),e=r.getItem("user.data.key")||t,this._userData.load(e)},_loadStockData:function(){var t,e,n,o,c;for(e in n=this._allStockDataObj)t=(c=n[e]).save(),o=r.getItem("stock.data.key"+e)||t,c.load(o)},_registerEventListener:function(){return this.node.on("buyStock",function(t){return function(e){var n,o,c,r,a,i,s,u,l,d,f,g,h;if(f=e.stockCode,o=(u=e.num)*(l=(g=t._allStockDataObj[f]).getPrice()),h=g.getName(),(c=t._userData.getMoney())>=o){for(n=c-o,t._userData.setMoney(n),i=!1,a=0,s=(r=t._userData.getOwnStocks()).length;a<s;a++)if((d=r[a]).stockName===h){i=!0,l=(d.num*d.price+u*l)/(d.num+u)*100,d.price=Math.floor(l/100),d.num+=u;break}!1===i&&r.push({stockCode:f,stockName:h,num:u,price:l}),t._userData.setOwnStocks(r),t._saveUserData()}return console.log("msg : "+JSON.stringify({stockName:h,num:u,price:l}))}}(this)),this.node.on("nextYear",function(t){return function(n){var o,c,r,a,i;return i=t._userData.getYear(),5===(r=t._randomInt(1,10))||8===r?c=!0:1!==(a=t._randomInt(1,10))&&5!==a&&9!==a||(o=!0),i<e.length-1?(t._userData.addYear(),t._updateStockData(c,o),t._saveUserData(),t._saveStockData(),n(!0)):(n(!1),cc.director.loadScene("EndDialog"))}}(this)),this.node.on("getUserData",function(t){return function(e){return e(t._userData)}}(this)),this.node.on("getOwnStockNum",function(t){return function(e){var n;return n=e.stockCode,(0,e.callback)(t._getStockNum(n))}}(this)),this.node.on("saleStock",function(t){return function(e){var n,o,c,r;if(r=e.stockCode,c=e.num,!(t._getStockNum(r)<c))return o=c*t._allStockDataObj[r].getPrice(),n=t._userData.getMoney()+o,t._userData.setMoney(n),t._delStockNum(r,c)}}(this)),this.node.on("getMoney",function(t){return function(e){var n,o,c,r,a,i,s;for(r=Math.floor(t._userData.getMoney()),i=0,o=0,c=(n=t._userData.getOwnStocks()).length;o<c;o++)a=n[o],s=t._getStockPriceByStockCode(a.stockCode),i+=a.num*s;return e({money:r,stockMoney:i=Math.floor(i)})}}(this)),this.node.on("getStockPrice",function(t){return function(e){var n,o;return n=e.callback,o=e.stockCode,n(t._getStockPriceByStockCode(o))}}(this)),this.node.on("getStockPE",function(t){return function(e){var n,o;return n=e.callback,o=e.stockCode,n(t._allStockDataObj[o].getPE())}}(this)),this.node.on("getStockName",function(t){return function(e){var n,o;return n=e.callback,o=e.stockCode,n(t._allStockDataObj[o].getName())}}(this)),this.node.on("showExchangeDialog",function(){return cc.director.loadScene("ExchangePanel")}),this.node.on("getYear",function(t){return function(e){return e(t._userData.getYear())}}(this)),this.node.on("openMyStockDialog",function(){return cc.director.loadScene("OwnStocksDialog")}),this.node.on("getOwnStocks",function(t){return function(e){return e(t._userData.getOwnStocks())}}(this)),this.node.on("resetGame",function(t){return function(){var e,n,o,c,a,i;for(n in t._userData.reset(),t._saveUserData(),o=t._allStockDataObj)i=o[n],r.setItem("stock.data.key"+n,null);for(n in t._initStockInfo(),c=t._allStockDataObj)(i=c[n]).reset(),e=i.save(),a=r.getItem("stock.data.key"+n)||e,i.load(a)}}(this))},_delStockNum:function(t,e){var n,o,c,r,a,i,s;for(s=null,c=o=0,r=(i=this._userData.getOwnStocks()).length;o<r;c=++o)if(t===(a=i[c]).stockCode){s=a;break}return 0===(n=s.num-e)?i.splice(c,1):s.num=n},_getStockNum:function(t){var e,n,o,c;for(e=0,n=(c=this._userData.getOwnStocks()).length;e<n;e++)if(t===(o=c[e]).stockCode)return o.num;return 0},_getStockPriceByStockCode:function(t){return this._allStockDataObj[t].getPrice()},_randomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},_updateStockData:function(t,n){var o,c,r,a,i,s,u,l,d,f,g,h,_,p,m;for(u in m=this._userData.getYear(),i=e[m],h=this._allStockDataObj)_=h[u],!0===t||!0===n?(p=0,!0===t&&(p=30),!0===n&&(p=_.getOriginPE()),c=((p+=this._randomInt(-2,2))-(o=_.getPE()))/o,d=_.getPrice(),a=Math.floor(d*(1+c)*100)/100,_.setPrice(a),_.setPE(p)):(d=_.getPrice(),f=_.getPriceWave(),g=this._randomInt(-f,f),a=Math.floor(((g+i)/100+1)*d*100),a/=100,_.setPrice(a),o=_.getPE(),s=g+i,l=_.getPEWave(),r=Math.floor((s*(1-l)/100+1)*o*100)/100,_.setPE(r))},_saveUserData:function(){var t;return t=this._userData.save(),r.setItem("user.data.key",t)},_saveStockData:function(){var t,e,n;for(e in n=this._allStockDataObj)t=n[e].save(),r.setItem("stock.data.key"+e,t)},_setItem:function(t,e){return cc.sys.localStorage.setItem(t,JSON.stringify(e))},_getItem:function(t){try{return JSON.parse(cc.sys.localStorage.getItem(t))}catch(t){}},_initStockInfo:function(){var t,e,c;for(t in this._allStockDataObj={},o)c=o[t],e=new n(c),this._allStockDataObj[t]=e}})}.call(this),cc._RF.pop()},{"./StockData":"StockData","./UserData":"UserData","./Utils":"Utils","./stockInfo":"stockInfo"}],stockInfo:[function(t,e,n){"use strict";cc._RF.push(e,"2d2abomVUlH2oKUekzADAPr","stockInfo"),function(){e.exports={"001":{name:"\u7a7a\u8c03",price:15,priceWave:15,PE:10,PEWave:.8},"002":{name:"\u767d\u9152",price:20,priceWave:20,PE:25,PEWave:.8},"003":{name:"\u5149\u901f\u98de\u8239",price:100,priceWave:50,PE:60,PEWave:.3},"004":{name:"\u836f\u5382",price:60,priceWave:30,PE:40,PEWave:.6},"005":{name:"\u7535\u89c6",price:30,priceWave:30,PE:30,PEWave:.3},"006":{name:"\u623f\u5730\u4ea7",price:15,priceWave:10,PE:12,PEWave:.5},"007":{name:"\u6e38\u620f",price:200,priceWave:30,PE:35,PEWave:.8},"008":{name:"\u7f51\u8d2d",price:80,priceWave:30,PE:30,PEWave:.8},"009":{name:"\u957f\u751f\u4e0d\u8001",price:500,priceWave:20,PE:100,PEWave:.1},"010":{name:"\u4efb\u610f\u95e8",price:150,priceWave:80,PE:80,PEWave:.3}}}.call(this),cc._RF.pop()},{}]},{},["EndDialog","ExchangePanel","HelpDialog","OwnStocksDialog","Record","StockData","UserData","Utils","WelcomeDialog","game","logic","stockInfo"]);